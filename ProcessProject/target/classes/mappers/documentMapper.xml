<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.mappers.documentMapper">

<!-- title, content, author_id, position, newFile, oldFile, temp, size, views, upload_date, thumbs_up, folder -->
	<!-- 게시물 작성 -->
	<insert id="upload" parameterType="com.edu.domain.DocumentVO" useGeneratedKeys="true" keyProperty="id">
		insert into
			document(author_id, title, content, position, newFile, oldFile, temp, size, views, upload_date, thumbs_up, folder, type, fileName)
				values(#{author_id}, #{title}, #{content}, #{position}, #{newFile},#{newFile},#{newFile}, #{size}, 0, NOW(), 0, null, #{type}, #{fileName})
	</insert>
	
	<!-- 게시물 수정 -->
	<update id="update" parameterType="com.edu.domain.DocumentVO">
		update 
			document
				set
					title = #{title},
					content = #{content},
					
					newFile=#{newFile},
					oldFile=temp,
					temp = newFile,
					
					size=#{size},
					fileName=#{fileName},
					type=#{type}
					
				where
					document_code = #{document_code}
	</update>
	<!-- 게시물 삭제 -->
	<delete id="delete" parameterType="String">
		delete from
			document
				where 
					document_code = #{document_code} 
	</delete>
	<!-- 게시물 조회 -->
	<select id="view"  resultType="com.edu.domain.DocumentVO">
		select
			document_code, author_id, title, content, views, newFile, upload_date, fileName, size, type, emp.name_kor
		from 
			document doc, employees emp
		where 
			document_code = #{document_code} <!-- and doc.author_id=emp.id 
		Order by doc.document_code desc limit 1 -->
			
	</select>
	<!-- 게시물 목록 -->
	<select id="list" resultType="com.edu.domain.DocumentVO">
		select
			*
				from document
	</select>

	<update id="viewCnt" parameterType="com.edu.domain.DocumentVO">
		update document
		set views=views+1
		where document_code = #{document_code}
	</update>
	
	 <insert id="likeUp" parameterType="com.edu.domain.likeVO">
		insert into LIKES_doc (document_code, id, checks) 
		values (#{document_code}, #{id}, 1)  
	</insert>
	
	<delete id="likeDown" parameterType="String">
		delete from LIKES_doc
		where id = #{id}
	</delete> 
	
	<select id="like" resultType="String">
		select count(*) from likes_doc where document_code=#{document_code}
	</select>

	<select id="likeCheck" parameterType="com.edu.domain.likeVO" resultType="String">
		select * from likes_doc where document_code=#{document_code} and id=#{id}	
	</select>
	
	<insert id="makeFolder" parameterType="String">
		insert into
			folder(folder)
				values(#{folder})
	</insert>
	
	<select id="findFolder" resultType="String">
		select count(*) from folder where folder=#{folder}
	</select>
</mapper>

